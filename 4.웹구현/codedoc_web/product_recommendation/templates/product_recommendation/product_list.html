{% extends 'base.html' %}
{% load static %}

{% block title %}ìƒí’ˆì†Œê°œ - CODEDOC{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'product_recommendation/css/product_list.css' %}?v={{ STATIC_VERSION }}">
{% endblock %}

{% block content %}
<div class="container">
    <!-- í˜ì´ì§€ í—¤ë” -->
    <div class="page-header">
        <h1 class="page-title">ë¬´ì—‡ì„ ë³´ì¥í•´ ë“œë¦´ê¹Œìš”?</h1>
        <p class="page-subtitle">ê³ ê°ë‹˜ê»˜ ë§ëŠ” ìµœì ì˜ ê¸ˆìœµìƒí’ˆì„ ì°¾ì•„ë³´ì„¸ìš”</p>
    </div>


    <!-- í•„í„° íƒ­ (6ê°œë¡œ í™•ì¥) -->
    <!-- AI ì¶”ì²œ ìƒí’ˆ ì„¹ì…˜ -->
    {% if recommended_products %}
    <div class="recommendation-section">
        <h2 class="section-title">íšŒì›ë‹˜ì„ ìœ„í•œ AI ì¶”ì²œ ìƒí’ˆ ğŸ’</h2>
        <div class="products-grid">
            {% for product in recommended_products %}
                <div class="product-cards">
                    <span class="product-badge recommended-badge">{{ product.product_type_name }}</span>
                    <h3 class="product-name">{{ product.fin_prdt_nm }}</h3>
                    <p class="product-subtitle">AIê°€ íšŒì›ë‹˜ì˜ í”„ë¡œí•„ì„ ë¶„ì„í•˜ì—¬ ì¶”ì²œí•˜ëŠ” ë§ì¶¤ ìƒí’ˆì…ë‹ˆë‹¤.</p>
                    
                    <div class="product-info">
                        <div class="info-label">ê¸ˆìœµíšŒì‚¬</div>
                        <div class="info-value">{{ product.kor_co_nm }}</div>
                    </div>
                    
                    <div class="product-info">
                        <div class="info-label">ê°€ì…ë°©ë²•</div>
                        <div class="info-value">{{ product.join_way|default:"ì˜¨ë¼ì¸ ê°€ì… ê°€ëŠ¥" }}</div>
                    </div>
                    
                    <div class="product-tags">
                        <span class="tag">#AIì¶”ì²œ</span>
                        <span class="tag">#ë§ì¶¤ìƒí’ˆ</span>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- í•„í„° íƒ­ -->

    <div class="filter-tabs">
        <button class="filter-btn active" data-filter="all">ì „ì²´</button>
        <button class="filter-btn" data-filter="deposit">ì˜ˆê¸ˆ</button>
        <button class="filter-btn" data-filter="saving">ì ê¸ˆ</button>
        <button class="filter-btn" data-filter="fund">í€ë“œ</button>
        <button class="filter-btn" data-filter="stock">ì£¼ì‹</button>
        <button class="filter-btn" data-filter="mmf">ë¨¸ë‹ˆë§ˆì¼“í€ë“œ</button>
    </div>

    {% if error %}
        <div class="error-message">
            <h3>ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤</h3>
            <p>{{ error }}</p>
        </div>
    {% else %}
        <!-- ì „ì²´ ìƒí’ˆ ì„¹ì…˜ -->
        <div class="products-section" data-category="all">
            <h2 class="section-title">ì „ì²´ {{ all_total }}ê°œ ìƒí’ˆ</h2>
            <div class="products-grid">
                {% for product in all_products %}
                    <div class="product-cards">
                        <span class="product-badge">{{ product.product_type_name }}/ë³´ì¥</span>
                        <h3 class="product-name">{{ product.fin_prdt_nm }}</h3>
                        <p class="product-subtitle">
                            {% if product.product_type == 'deposit' %}
                                ì†Œì¤‘í•œ ë‚´ ê°€ì¡±ì„ ìœ„í•œ í˜„ëª…í•œ ì„ íƒ!
                            {% elif product.product_type == 'saving' %}
                                ì„¸ë°”ë¥¼ê³¨ê³ ì˜ ë“ ë“ í•œ ì„¸ê°€ì§€ ì•½ì†!
                            {% elif product.product_type == 'fund' %}
                                ì „ë¬¸ê°€ê°€ ìš´ìš©í•˜ëŠ” ì•ˆì •ì ì¸ íˆ¬ì!
                            {% elif product.product_type == 'stock' %}
                                ì„±ì¥ ê°€ëŠ¥ì„± ë†’ì€ ìš°ëŸ‰ ì£¼ì‹!
                            {% elif product.product_type == 'mmf' %}
                                ì–¸ì œë“ ì§€ ì°¾ì„ ìˆ˜ ìˆëŠ” ì•ˆì „í•œ íˆ¬ì!
                            {% endif %}
                        </p>
                        
                        <div class="product-info">
                            <div class="info-label">ìƒí’ˆ ìœ í˜•</div>
                            <div class="info-value">{{ product.product_type_name }}</div>
                        </div>
                        
                        <div class="product-info">
                            <div class="info-label">
                                {% if product.product_type == 'fund' or product.product_type == 'mmf' %}
                                    ìì‚°ìš´ìš©ì‚¬
                                {% elif product.product_type == 'stock' %}
                                    ì¢…ëª©ëª…
                                {% else %}
                                    ê¸ˆìœµíšŒì‚¬
                                {% endif %}
                            </div>
                            <div class="info-value">{{ product.kor_co_nm }}</div>
                        </div>
                        
                        {% if product.product_type == 'stock' %}
                            <div class="product-info">
                                <div class="info-label">í˜„ì¬ê°€</div>
                                <div class="info-value rate-highlight">{{ product.current_price|floatformat:0 }}ì›</div>
                            </div>
                            <div class="product-info">
                                <div class="info-label">ë“±ë½ë¥ </div>
                                <div class="info-value {% if product.change_rate >= 0 %}rate-positive{% else %}rate-negative{% endif %}">
                                    {% if product.change_rate >= 0 %}+{% endif %}{{ product.change_rate|floatformat:2 }}%
                                </div>
                            </div>
                        {% elif product.product_type == 'fund' or product.product_type == 'mmf' %}
                            <div class="product-info">
                                <div class="info-label">ìˆ˜ìµë¥ </div>
                                <div class="info-value rate-highlight">{{ product.return_rate|floatformat:2 }}%</div>
                            </div>
                            <div class="product-info">
                                <div class="info-label">ìµœì†Œíˆ¬ìê¸ˆì•¡</div>
                                <div class="info-value">{{ product.min_invest }}</div>
                            </div>
                        {% else %}
                            <div class="product-info">
                                <div class="info-label">ê°€ì…ë°©ë²•</div>
                                <div class="info-value">{{ product.join_way|default:"ì˜¨ë¼ì¸ ê°€ì… ê°€ëŠ¥" }}</div>
                            </div>
                        {% endif %}
                        
                        <div class="product-tags">
                            {% if product.product_type == 'deposit' %}
                                <span class="tag">#ë³´ì¥</span>
                                <span class="tag">#ì˜ˆê¸ˆ</span>
                                <span class="tag">#ì•ˆì „</span>
                            {% elif product.product_type == 'saving' %}
                                <span class="tag">#ì„±ì¸ìš°ëŒ€í˜œíƒ</span>
                                <span class="tag">#ì ê¸ˆ</span>
                                <span class="tag">#ì €ì¶•</span>
                            {% elif product.product_type == 'fund' %}
                                <span class="tag">#{{ product.fund_type }}</span>
                                <span class="tag">#ìœ„í—˜ë„{{ product.risk_level }}</span>
                                <span class="tag">#ì „ë¬¸ìš´ìš©</span>
                            {% elif product.product_type == 'stock' %}
                                <span class="tag">#{{ product.sector }}</span>
                                <span class="tag">#{{ product.market_div }}</span>
                                <span class="tag">#ê°œë³„íˆ¬ì</span>
                            {% elif product.product_type == 'mmf' %}
                                <span class="tag">#ë‹¨ê¸°ê¸ˆìœµ</span>
                                <span class="tag">#ë‹¹ì¼ì¶œê¸ˆ</span>
                                <span class="tag">#ì•ˆì „íˆ¬ì</span>
                            {% endif %}
                        </div>
                    </div>
                {% empty %}
                    <p>ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.</p>
                {% endfor %}
            </div>
            
            <!-- ì „ì²´ ìƒí’ˆ í˜ì´ì§€ë„¤ì´ì…˜ -->
            {% if all_products.has_other_pages %}
                <div class="pagination-container">
                    <div class="pagination">
                        {% if all_products.has_previous %}
                            <a href="?page={{ all_products.previous_page_number }}">&lsaquo; ì´ì „</a>
                        {% endif %}
                        
                        {% for num in all_products.paginator.page_range %}
                            {% if num <= 5 %}
                                {% if all_products.number == num %}
                                    <span class="current">{{ num }}</span>
                                {% else %}
                                    <a href="?page={{ num }}">{{ num }}</a>
                                {% endif %}
                            {% endif %}
                        {% endfor %}
                        
                        {% if all_products.has_next %}
                            <a href="?page={{ all_products.next_page_number }}">ë‹¤ìŒ &rsaquo;</a>
                        {% endif %}
                    </div>
                    <div class="pagination-info">
                        {{ all_products.start_index }}-{{ all_products.end_index }} / ì´ {{ all_total }}ê°œ
                    </div>
                </div>
            {% endif %}
        </div>

        <!-- ì˜ˆê¸ˆ ìƒí’ˆ ì„¹ì…˜ -->
        <div class="products-section" data-category="deposit" style="display: none;">
            <h2 class="section-title">ì˜ˆê¸ˆ {{ deposits_total }}ê°œ ìƒí’ˆ</h2>
            <div class="products-grid">
                {% for product in deposits %}
                    <div class="product-cards">
                        <span class="product-badge">ì˜ˆê¸ˆ/ë³´ì¥</span>
                        <h3 class="product-name">{{ product.fin_prdt_nm }}</h3>
                        <p class="product-subtitle">ì†Œì¤‘í•œ ë‚´ ê°€ì¡±ì„ ìœ„í•œ í˜„ëª…í•œ ì„ íƒ!</p>
                        
                        <div class="product-info">
                            <div class="info-label">ê¸ˆìœµíšŒì‚¬</div>
                            <div class="info-value">{{ product.kor_co_nm }}</div>
                        </div>
                        
                        <div class="product-info">
                            <div class="info-label">ê°€ì…ë°©ë²•</div>
                            <div class="info-value">{{ product.join_way|default:"ì˜¨ë¼ì¸ ê°€ì… ê°€ëŠ¥" }}</div>
                        </div>
                        
                        <div class="product-tags">
                            <span class="tag">#ë³´ì¥</span>
                            <span class="tag">#ì˜ˆê¸ˆ</span>
                            <span class="tag">#ì•ˆì „</span>
                        </div>
                    </div>
                {% empty %}
                    <p>ì˜ˆê¸ˆ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.</p>
                {% endfor %}
            </div>
            
            <!-- ì˜ˆê¸ˆ í˜ì´ì§€ë„¤ì´ì…˜ -->
            {% if deposits.has_other_pages %}
                <div class="pagination-container">
                    <div class="pagination">
                        {% if deposits.has_previous %}
                            <a href="?deposits_page={{ deposits.previous_page_number }}">&lsaquo; ì´ì „</a>
                        {% endif %}
                        
                        {% for num in deposits.paginator.page_range %}
                            {% if num <= 5 %}
                                {% if deposits.number == num %}
                                    <span class="current">{{ num }}</span>
                                {% else %}
                                    <a href="?deposits_page={{ num }}">{{ num }}</a>
                                {% endif %}
                            {% endif %}
                        {% endfor %}
                        
                        {% if deposits.has_next %}
                            <a href="?deposits_page={{ deposits.next_page_number }}">ë‹¤ìŒ &rsaquo;</a>
                        {% endif %}
                    </div>
                    <div class="pagination-info">
                        {{ deposits.start_index }}-{{ deposits.end_index }} / ì´ {{ deposits_total }}ê°œ
                    </div>
                </div>
            {% endif %}
        </div>

        <!-- ì ê¸ˆ ìƒí’ˆ ì„¹ì…˜ -->
        <div class="products-section" data-category="saving" style="display: none;">
            <h2 class="section-title">ì ê¸ˆ {{ savings_total }}ê°œ ìƒí’ˆ</h2>
            <div class="products-grid">
                {% for product in savings %}
                    <div class="product-cards">
                        <span class="product-badge">ì ê¸ˆ/ë³´ì¥</span>
                        <h3 class="product-name">{{ product.fin_prdt_nm }}</h3>
                        <p class="product-subtitle">ì„¸ë°”ë¥¼ê³¨ê³ ì˜ ë“ ë“ í•œ ì„¸ê°€ì§€ ì•½ì†!</p>
                        
                        <div class="product-info">
                            <div class="info-label">ê¸ˆìœµíšŒì‚¬</div>
                            <div class="info-value">{{ product.kor_co_nm }}</div>
                        </div>
                        
                        <div class="product-info">
                            <div class="info-label">ê°€ì…ë°©ë²•</div>
                            <div class="info-value">{{ product.join_way|default:"ì˜¨ë¼ì¸ ê°€ì… ê°€ëŠ¥" }}</div>
                        </div>
                        
                        <div class="product-tags">
                            <span class="tag">#ì„±ì¸ìš°ëŒ€í˜œíƒ</span>
                            <span class="tag">#ì ê¸ˆ</span>
                            <span class="tag">#ì €ì¶•</span>
                        </div>
                    </div>
                {% empty %}
                    <p>ì ê¸ˆ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.</p>
                {% endfor %}
            </div>
            
            <!-- ì ê¸ˆ í˜ì´ì§€ë„¤ì´ì…˜ -->
            {% if savings.has_other_pages %}
                <div class="pagination-container">
                    <div class="pagination">
                        {% if savings.has_previous %}
                            <a href="?savings_page={{ savings.previous_page_number }}">&lsaquo; ì´ì „</a>
                        {% endif %}
                        
                        {% for num in savings.paginator.page_range %}
                            {% if num <= 5 %}
                                {% if savings.number == num %}
                                    <span class="current">{{ num }}</span>
                                {% else %}
                                    <a href="?savings_page={{ num }}">{{ num }}</a>
                                {% endif %}
                            {% endif %}
                        {% endfor %}
                        
                        {% if savings.has_next %}
                            <a href="?savings_page={{ savings.next_page_number }}">ë‹¤ìŒ &rsaquo;</a>
                        {% endif %}
                    </div>
                    <div class="pagination-info">
                        {{ savings.start_index }}-{{ savings.end_index }} / ì´ {{ savings_total }}ê°œ
                    </div>
                </div>
            {% endif %}
        </div>

        <!-- í€ë“œ ìƒí’ˆ ì„¹ì…˜ -->
        <div class="products-section" data-category="fund" style="display: none;">
            <h2 class="section-title">í€ë“œ {{ funds_total }}ê°œ ìƒí’ˆ</h2>
            <div class="products-grid">
                {% for product in funds %}
                    <div class="product-cards">
                        <span class="product-badge">í€ë“œ/íˆ¬ì</span>
                        <h3 class="product-name">{{ product.fin_prdt_nm }}</h3>
                        <p class="product-subtitle">ì „ë¬¸ê°€ê°€ ìš´ìš©í•˜ëŠ” ì•ˆì •ì ì¸ íˆ¬ì!</p>
                        
                        <div class="product-info">
                            <div class="info-label">ìì‚°ìš´ìš©ì‚¬</div>
                            <div class="info-value">{{ product.kor_co_nm }}</div>
                        </div>
                        
                        <div class="product-info">
                            <div class="info-label">í€ë“œìœ í˜•</div>
                            <div class="info-value">{{ product.fund_type }}</div>
                        </div>
                        
                        <div class="product-info">
                            <div class="info-label">ìˆ˜ìµë¥ (1ë…„)</div>
                            <div class="info-value rate-highlight">{{ product.return_rate|floatformat:2 }}%</div>
                        </div>
                        
                        <div class="product-info">
                            <div class="info-label">ìµœì†Œíˆ¬ìê¸ˆì•¡</div>
                            <div class="info-value">{{ product.min_invest }}</div>
                        </div>
                        
                        <div class="product-tags">
                            <span class="tag">#{{ product.fund_type }}</span>
                            <span class="tag">#ìœ„í—˜ë„{{ product.risk_level }}</span>
                            <span class="tag">#ì „ë¬¸ìš´ìš©</span>
                        </div>
                    </div>
                {% empty %}
                    <p>í€ë“œ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.</p>
                {% endfor %}
            </div>
            
            <!-- í€ë“œ í˜ì´ì§€ë„¤ì´ì…˜ -->
            {% if funds.has_other_pages %}
                <div class="pagination-container">
                    <div class="pagination">
                        {% if funds.has_previous %}
                            <a href="?funds_page={{ funds.previous_page_number }}">&lsaquo; ì´ì „</a>
                        {% endif %}
                        
                        {% for num in funds.paginator.page_range %}
                            {% if num <= 5 %}
                                {% if funds.number == num %}
                                    <span class="current">{{ num }}</span>
                                {% else %}
                                    <a href="?funds_page={{ num }}">{{ num }}</a>
                                {% endif %}
                            {% endif %}
                        {% endfor %}
                        
                        {% if funds.has_next %}
                            <a href="?funds_page={{ funds.next_page_number }}">ë‹¤ìŒ &rsaquo;</a>
                        {% endif %}
                    </div>
                    <div class="pagination-info">
                        {{ funds.start_index }}-{{ funds.end_index }} / ì´ {{ funds_total }}ê°œ
                    </div>
                </div>
            {% endif %}
        </div>

        <!-- ì£¼ì‹ ìƒí’ˆ ì„¹ì…˜ -->
        <div class="products-section" data-category="stock" style="display: none;">
            <h2 class="section-title">ì£¼ì‹ {{ stocks_total }}ê°œ ìƒí’ˆ</h2>
            <div class="products-grid">
                {% for product in stocks %}
                    <div class="product-cards">
                        <span class="product-badge">ì£¼ì‹/íˆ¬ì</span>
                        <h3 class="product-name">{{ product.stock_nm }}</h3>
                        <p class="product-subtitle">ì„±ì¥ ê°€ëŠ¥ì„± ë†’ì€ ìš°ëŸ‰ ì£¼ì‹!</p>
                        
                        <div class="product-info">
                            <div class="info-label">ì¢…ëª©ì½”ë“œ</div>
                            <div class="info-value">{{ product.stock_code }}</div>
                        </div>
                        
                        <div class="product-info">
                            <div class="info-label">ì—…ì¢…</div>
                            <div class="info-value">{{ product.sector }}</div>
                        </div>
                        
                        <div class="product-info">
                            <div class="info-label">í˜„ì¬ê°€</div>
                            <div class="info-value rate-highlight">{{ product.current_price|floatformat:0 }}ì›</div>
                        </div>
                        
                        <div class="product-info">
                            <div class="info-label">ë“±ë½ë¥ </div>
                            <div class="info-value {% if product.change_rate >= 0 %}rate-positive{% else %}rate-negative{% endif %}">
                                {% if product.change_rate >= 0 %}+{% endif %}{{ product.change_rate|floatformat:2 }}%
                            </div>
                        </div>
                        
                        <div class="product-tags">
                            <span class="tag">#{{ product.sector }}</span>
                            <span class="tag">#{{ product.market_div }}</span>
                            <span class="tag">#ê°œë³„íˆ¬ì</span>
                        </div>
                    </div>
                {% empty %}
                    <p>ì£¼ì‹ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.</p>
                {% endfor %}
            </div>
            
            <!-- ì£¼ì‹ í˜ì´ì§€ë„¤ì´ì…˜ -->
            {% if stocks.has_other_pages %}
                <div class="pagination-container">
                    <div class="pagination">
                        {% if stocks.has_previous %}
                            <a href="?stocks_page={{ stocks.previous_page_number }}">&lsaquo; ì´ì „</a>
                        {% endif %}
                        
                        {% for num in stocks.paginator.page_range %}
                            {% if num <= 5 %}
                                {% if stocks.number == num %}
                                    <span class="current">{{ num }}</span>
                                {% else %}
                                    <a href="?stocks_page={{ num }}">{{ num }}</a>
                                {% endif %}
                            {% endif %}
                        {% endfor %}
                        
                        {% if stocks.has_next %}
                            <a href="?stocks_page={{ stocks.next_page_number }}">ë‹¤ìŒ &rsaquo;</a>
                        {% endif %}
                    </div>
                    <div class="pagination-info">
                        {{ stocks.start_index }}-{{ stocks.end_index }} / ì´ {{ stocks_total }}ê°œ
                    </div>
                </div>
            {% endif %}
        </div>

        <!-- ë¨¸ë‹ˆë§ˆì¼“í€ë“œ ìƒí’ˆ ì„¹ì…˜ -->
        <div class="products-section" data-category="mmf" style="display: none;">
            <h2 class="section-title">ë¨¸ë‹ˆë§ˆì¼“í€ë“œ {{ mmf_total }}ê°œ ìƒí’ˆ</h2>
            <div class="products-grid">
                {% for product in mmf_products %}
                    <div class="product-cards">
                        <span class="product-badge">MMF/íˆ¬ì</span>
                        <h3 class="product-name">{{ product.fin_prdt_nm }}</h3>
                        <p class="product-subtitle">ì–¸ì œë“ ì§€ ì°¾ì„ ìˆ˜ ìˆëŠ” ì•ˆì „í•œ íˆ¬ì!</p>
                        
                        <div class="product-info">
                            <div class="info-label">ìì‚°ìš´ìš©ì‚¬</div>
                            <div class="info-value">{{ product.kor_co_nm }}</div>
                        </div>
                        
                        <div class="product-info">
                            <div class="info-label">ìœ ë™ì„±</div>
                            <div class="info-value">{{ product.liquidity }}</div>
                        </div>
                        
                        <div class="product-info">
                            <div class="info-label">ìˆ˜ìµë¥ (7ì¼)</div>
                            <div class="info-value rate-highlight">{{ product.return_rate|floatformat:2 }}%</div>
                        </div>
                        
                        <div class="product-info">
                            <div class="info-label">ìµœì†Œíˆ¬ìê¸ˆì•¡</div>
                            <div class="info-value">{{ product.min_invest }}</div>
                        </div>
                        
                        <div class="product-tags">
                            <span class="tag">#ë‹¨ê¸°ê¸ˆìœµ</span>
                            <span class="tag">#ë‹¹ì¼ì¶œê¸ˆ</span>
                            <span class="tag">#ì•ˆì „íˆ¬ì</span>
                        </div>
                    </div>
                {% empty %}
                    <p>ë¨¸ë‹ˆë§ˆì¼“í€ë“œ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.</p>
                {% endfor %}
            </div>
            
            <!-- ë¨¸ë‹ˆë§ˆì¼“í€ë“œ í˜ì´ì§€ë„¤ì´ì…˜ -->
            {% if mmf_products.has_other_pages %}
                <div class="pagination-container">
                    <div class="pagination">
                        {% if mmf_products.has_previous %}
                            <a href="?mmf_page={{ mmf_products.previous_page_number }}">&lsaquo; ì´ì „</a>
                        {% endif %}
                        
                        {% for num in mmf_products.paginator.page_range %}
                            {% if num <= 5 %}
                                {% if mmf_products.number == num %}
                                    <span class="current">{{ num }}</span>
                                {% else %}
                                    <a href="?mmf_page={{ num }}">{{ num }}</a>
                                {% endif %}
                            {% endif %}
                        {% endfor %}
                        
                        {% if mmf_products.has_next %}
                            <a href="?mmf_page={{ mmf_products.next_page_number }}">ë‹¤ìŒ &rsaquo;</a>
                        {% endif %}
                    </div>
                    <div class="pagination-info">
                        {{ mmf_products.start_index }}-{{ mmf_products.end_index }} / ì´ {{ mmf_total }}ê°œ
                    </div>
                </div>
            {% endif %}
        </div>
    {% endif %}
</div>

<script src="{% static 'product_recommendation/js/product_list.js' %}"></script>
{% endblock %}